(ns y-om.core
  (:require-macros [cljs.core.async.macros :refer [go alt!]])
  (:require
   [cljs.core.async :as async :refer [>! <! alts! chan sliding-buffer put! close!]]
   [y-om.app-state :as app-state]
   [om.core :as om :include-macros true]
   [om.dom :as dom :include-macros true]
   [sablono.core :as html :refer-macros [html]]
   [y-om.components.board-header :as header]
   [y-om.components.cards :as cards]
   [y-om.components.columns :as columns]
   [y-om.components.draggable :as dnd]))

(enable-console-print!)

(defn board-view [data owner]
  (reify
    om/IInitState
    (init-state [_]
      {:c-board-control (chan)
       :c-column-drag (chan)
       :add-new-column? false})

    om/IRenderState
    (render-state [_ {:keys [c-board-control
                             add-new-column?]}]
      (html [:div.container
             (om/build header/board-header (:board-info data))
             [:div.board-container
              (om/build-all columns/columns-view (:columns data))
              [:div.column
               (if add-new-column?
                 (render-input owner data add-column "" :add-new-column?  "add-column" "Save")
                 [:div.add-column {:on-click #(toggle-component-state owner :add-new-column?)} "Add a list..."])]]]))))

(defn app [data owner]
  (om/component
   (html [:div
          (om/build board-view data)])))

(om/root
 app
 app-state/app-state
 {:target (. js/document (getElementById "app"))})



